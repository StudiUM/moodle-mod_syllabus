define(["jquery","core/str","core/notification"],function(a,b,c){var d=function(a,b){this.configdatepicker=a,this.configmanageline=b,this.tabsinit(),this.managelines()};return d.prototype.nbrepeat=[],d.prototype.configdatepicker=[],d.prototype.configmanageline=[],d.prototype.managelines=function(){var d=this;a.each(this.configmanageline,function(b,c){d.nbrepeat[c.identifier]=parseInt(a('input[name="'+c.name+'"]').val()),d.reorderlines(c.identifier,c.name)}),a("#page-mod-syllabus-edit").on("click","a.deleteline",function(e){e.preventDefault();var f=a(this).data("id"),g=a(this).data("repeat"),h=a(this);b.get_strings([{key:"confirm",component:"moodle"},{key:"confirmdeleteline",component:"mod_syllabus"},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){c.confirm(a[0],a[1],a[2],a[3],function(){var a=h.closest("tr");a.remove(),d.nbrepeat[f]--,d.reorderlines(f,g)})}).fail(c.exception)}),a("#page-mod-syllabus-edit").on("click",".addline",function(b){b.preventDefault();var c=a(this).data("id"),e=a(this).data("repeat"),f=a("table#"+c+" tr.hidden");f.clone().addClass("newline").insertBefore("table#"+c+" tr.hidden"),a("#"+c+" .newline [name^='"+c+"_']").each(function(){var b=a(this).attr("name"),e=/newindex/g,f=d.nbrepeat[c]+1,g=b.replace(e,f.toString());a(this).attr("name",g)}),a(".newline").removeClass("newline hidden"),d.nbrepeat[c]++,d.reorderlines(c,e),Y.use("moodle-form-dateselector",function(){M.form.dateselector.init_date_selectors(d.configdatepicker)})})},d.prototype.reorderlines=function(b,c){var d=this;a("#"+b+" tbody tr:not(.hidden)").each(function(c){a(this).find("[name^='"+b+"_']").each(function(){var b=a(this).attr("name"),d=/\[[\d]\]/g,e=b.replace(d,"["+c.toString()+"]");a(this).attr("name",e)})}),a('input[name="'+c+'"]').val(d.nbrepeat[b])},d.prototype.tabsinit=function(){b.get_strings([{key:"collapseall"},{key:"expandall"}]).done(function(b){var c=b[0],d=b[1];a(".syllabus").on("click",".collapsible-actions a",function(b){b.preventDefault();var e=a(this).closest("div.tab-pane").attr("id");a(this).hasClass("collapse-all")?(a(this).text(d),a(this).toggleClass("collapse-all expand-all"),a(".syllabus #"+e+" fieldset.collapsible:not(.collapsed) a.fheader").trigger("click")):(a(this).text(c),a(this).toggleClass("collapse-all expand-all"),a(".syllabus #"+e+" fieldset.collapsible.collapsed a.fheader").trigger("click"))}),a(".syllabus").on("click","ul.nav-tabs li.nav-item a",function(b){b.preventDefault();var c=a(this).data("tab");a('input[name="rubric"]').val(c)}),a(".syllabus legend a.fheader").on("click",function(b){b.preventDefault();var e=a(this).attr("aria-controls"),f=a(this).attr("aria-expanded"),g=a(this).closest("div.tab-pane").attr("id");f===!0?a(this).attr("aria-expanded",!1):a(this).attr("aria-expanded",!0),a("#"+e).toggleClass("collapsed");var h=!0,i=!0;a(".syllabus #"+g+" fieldset.collapsible").each(function(){h=a(this).hasClass("collapsed")&&h,i=!a(this).hasClass("collapsed")&&i});var j=a(".syllabus #"+g+" .collapsible-actions a");j.hasClass("collapse-all")&&h?(j.text(d),j.toggleClass("collapse-all expand-all")):j.hasClass("expand-all")&&i&&(j.text(c),j.toggleClass("collapse-all expand-all"))})}).fail(c.exception)},{init:function(a,b){new d(a,b)}}});